window.FB||(window.FB={}),GrunionFB_i18n=jQuery.extend({nameLabel:"Name",emailLabel:"Email",urlLabel:"Website",commentLabel:"Comment",newLabel:"New Field",optionsLabel:"Options",optionLabel:"Option",firstOptionLabel:"First option",problemGeneratingForm:"Oops, there was a problem generating your form.  You'll likely need to try again.",moveInstructions:"Drag up or down\nto re-arrange",moveLabel:"move",editLabel:"edit",savedMessage:"Saved successfully",requiredLabel:"(required)",exitConfirmMessage:"Are you sure you want to exit the form editor without saving?  Any changes you have made will be lost.",maxNewFields:5,invalidEmail:" is an invalid email address."},GrunionFB_i18n),GrunionFB_i18n.moveInstructions=GrunionFB_i18n.moveInstructions.replace("\n","<br />"),FB.span=jQuery("<span>"),FB.esc_html=function(e){return FB.span.text(e).html()},FB.esc_attr=function(e){return(e=FB.esc_html(e)).replace('"',"&quot;").replace("'","&#039;")},FB.ContactForm=function(){var e={action:"grunion_shortcode",_ajax_nonce:ajax_nonce_shortcode,to:"",subject:"",fields:{}},i={name:{label:GrunionFB_i18n.nameLabel,type:"name",required:!0,options:[],order:"1"},email:{label:GrunionFB_i18n.emailLabel,type:"email",required:!0,options:[],order:"2"},url:{label:GrunionFB_i18n.urlLabel,type:"url",required:!1,options:[],order:"3"},comment:{label:GrunionFB_i18n.commentLabel,type:"textarea",required:!0,options:[],order:"4"}},n=0,t=GrunionFB_i18n.maxNewFields,o={},r=0;function a(e,i){try{for(var n="",t=0;t<o[e].options.length;t++)void 0!==o[e].options[t]&&(n="radio"===i?n+'<div id="fb-radio-'+e+"-"+t+'"><input type="radio" id="fb-field'+e+'" name="radio-'+e+'" /><span>'+FB.esc_html(o[e].options[t])+'</span><div class="clear"></div></div>':"checkbox-multiple"===i?n+'<div id="fb-checkbox-multiple-'+e+"-"+t+'"><input type="checkbox" id="fb-field'+e+'" name="checkbox-multiple-'+e+'" /><span>'+FB.esc_html(o[e].options[t])+'</span><div class="clear"></div></div>':n+'<option id="fb-'+e+"-"+t+'" value="'+e+"-"+t+'">'+FB.esc_html(o[e].options[t])+"</option>");return n}catch(e){}}function l(i){try{scroll(0,0),setTimeout((function(){jQuery("#fb-new-label").focus().select()}),100),function(i){try{var n=e.fields[i].type;if(jQuery("#fb-options").hide(),jQuery("#fb-field-id").val(i),jQuery("#fb-new-label").val(e.fields[i].label),jQuery("#fb-new-type").val(e.fields[i].type),e.fields[i].required?jQuery("#fb-new-required").prop("checked",!0):jQuery("#fb-new-required").prop("checked",!1),"select"===n||"radio"===n||"checkbox-multiple"===n){var t=e.fields[i].options;jQuery("#fb-options").show(),jQuery("#fb-new-options").html("");for(var o=0;o<t.length;o++)void 0!==t[o]&&jQuery("#fb-new-options").append('<div id="fb-option-box-'+o+'" class="fb-new-fields"><span optionid="'+o+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+o+'" optionid="'+o+'" value="'+FB.esc_attr(e.fields[i].options[o])+'" class="fb-options" /><div>')}d()}catch(e){}}(i.parent().attr("fieldid"))}catch(e){}}function d(){jQuery("#fb-desc").hide(),jQuery("#fb-add-field").show()}function s(){try{return jQuery("#TB_imageOff",window.parent.document).unbind("click"),jQuery("#TB_closeWindowButton",window.parent.document).unbind("click"),jQuery("#TB_window",window.parent.document).fadeOut("fast"),jQuery("body",window.parent.document).removeClass("modal-open"),jQuery("#TB_window,#TB_overlay,#TB_HideSelect",window.parent.document).trigger("unload").unbind().remove(),jQuery("#TB_load",window.parent.document).remove(),void 0===window.parent.document.body.style.maxHeight&&(jQuery("body","html",window.parent.document).css({height:"auto",width:"auto"}),jQuery("html",window.parent.document).css("overflow","")),window.parent.document.onkeydown="",window.parent.document.onkeyup="",!1}catch(e){}}function f(e,i){try{"show"===e?(jQuery(".fb-edit-field").is(":visible")&&jQuery(".fb-edit-field").remove(),i.find("label").prepend('<span class="right fb-edit-field" style="font-weight: normal;"><a href="" class="fb-reorder"><div style="display: none;">'+GrunionFB_i18n.moveInstructions+"</div>"+GrunionFB_i18n.moveLabel+'</a>&nbsp;&nbsp;<span style="color: #C7D8DE;">|</span>&nbsp;&nbsp;<a href="" class="fb-edit">'+GrunionFB_i18n.editLabel+"</a></span>")):jQuery(".fb-edit-field").remove()}catch(e){}}function u(){try{var i=jQuery("#fb-field-id").val();jQuery("#fb-options").hide(),void 0===o[i]&&(o[i]={}),o[i].options=e.fields[i].options,e.fields[i].options=[]}catch(e){}}function c(){jQuery("#fb-desc").show(),jQuery("#fb-add-field").hide()}function b(e){try{var i=e||GrunionFB_i18n.savedMessage;jQuery("#fb-success").text(i),jQuery("#fb-success").slideDown("fast"),setTimeout((function(){jQuery("#fb-success").slideUp("fast")}),2500)}catch(e){}}function p(e){try{if("preview"===e){if(!function(e){if(0===e.length)return!0;var i,n=e.split(",");for(i=0;i<n.length;i++)if(!1===y(n[i]))return alert(n[i]+GrunionFB_i18n.invalidEmail),!1;return!0}(jQuery("#fb-field-my-email").val()))return;jQuery("#tab-preview a").addClass("current"),jQuery("#tab-settings a").removeClass("current"),jQuery("#fb-preview-form, #fb-desc").show(),jQuery("#fb-email-settings, #fb-email-desc").hide(),b(GrunionFB_i18n.savedMessage)}else jQuery("#tab-preview a").removeClass("current"),jQuery("#tab-settings a").addClass("current"),jQuery("#fb-preview-form, #fb-desc, #fb-add-field").hide(),jQuery("#fb-email-settings, #fb-email-desc").show(),jQuery("#fb-field-my-email").focus().select()}catch(e){}}function y(e){return/^(?=[a-z0-9@.!#$%&'*+/=?^_`{|}~-]{6,254}$)(?=[a-z0-9.!#$%&'*+/=?^_`{|}~-]{1,64}@)[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:(?=[a-z0-9-]{1,63}\.)[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+(?=[a-z0-9-]{1,63}$)[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i.test(e)}function v(i,n,t){try{var l=jQuery("#fb-field-id").val();i||(i=jQuery("#fb-new-type").val()),n||(n=jQuery("#fb-new-field"+l+" .label-text").text());var d=t?'<span class="label-required">'+GrunionFB_i18n.requiredLabel+"</span>":"",s='<label fieldid="'+l+'" for="fb-field'+l+'"><span class="label-text">'+FB.esc_html(n)+"</span>"+d+"</label>",f='<input type="radio" name="radio-'+l+'" id="fb-field'+l+' "disabled="disabled" />',c='<label fieldid="'+l+'" for="fb-field'+l+'" class="fb-radio-label"><span class="label-text">'+FB.esc_html(n)+"</span>"+d+"</label>",b='<div class="fb-remove fb-remove-small" id="'+l+'"></div>',p='<div class="fb-remove" id="'+l+'"></div>',y='<input type="checkbox" id="fb-field'+l+'" "disabled="disabled" />',v='<input type="checkbox" id="fb-field'+l+'" "disabled="disabled" />',m='<div class="fb-remove fb-remove-small" id="'+l+'"></div>',w='<input type="text" id="fb-field'+l+'" "disabled="disabled" />',j='<textarea id="fb-field'+l+'" "disabled="disabled"></textarea>',Q='<div class="clear"></div>',h='<select id="fb-field'+l+'" fieldid="'+l+'"><option id="fb-'+l+"-"+r+'" value="'+l+"-"+r+'">'+GrunionFB_i18n.firstOptionLabel+"</option></select>";switch(i){case"checkbox":u(),jQuery("#fb-new-field"+l+" .fb-fields").html(b+y+c+Q);break;case"checkbox-multiple":jQuery("#fb-new-field"+l+" .fb-fields").html(s+m+'<div fieldid="'+l+'" id="fb-custom-checkbox-multiple'+l+'"></div>'),void 0!==o[l]&&0!==o[l].options.length?(e.fields[l].options=o[l].options,jQuery("#fb-custom-checkbox-multiple"+l).append(a(l,i))):(jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />'),jQuery("#fb-custom-checkbox-multiple"+l).append('<div id="fb-checkbox-multiple-'+l+'-0">'+v+"<span>"+GrunionFB_i18n.firstOptionLabel+"</span>"+Q+"</div>"),e.fields[l].options[r]=GrunionFB_i18n.firstOptionLabel),jQuery("#fb-options").show(),setTimeout((function(){jQuery("#fb-option0").focus().select()}),100);break;case"email":case"name":case"text":case"url":u(),jQuery("#fb-new-field"+l+" .fb-fields").html(p+s+w);break;case"radio":jQuery("#fb-new-field"+l+" .fb-fields").html(s+b+'<div fieldid="'+l+'" id="fb-custom-radio'+l+'"></div>'),void 0!==o[l]&&0!==o[l].options.length?(e.fields[l].options=o[l].options,jQuery("#fb-custom-radio"+l).append(a(l,i))):(jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />'),jQuery("#fb-custom-radio"+l).append('<div id="fb-radio-'+l+'-0">'+f+"<span>"+GrunionFB_i18n.firstOptionLabel+"</span>"+Q+"</div>"),e.fields[l].options[r]=GrunionFB_i18n.firstOptionLabel),jQuery("#fb-options").show(),setTimeout((function(){jQuery("#fb-option0").focus().select()}),100);break;case"select":jQuery("#fb-new-field"+l+" .fb-fields").html(p+s+h),void 0!==o[l]&&0!==o[l].options.length?(e.fields[l].options=o[l].options,jQuery("#fb-field"+l).html(a(l,i))):(jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />'),e.fields[l].options[r]=GrunionFB_i18n.firstOptionLabel),jQuery("#fb-options").show(),setTimeout((function(){jQuery("#fb-option0").focus().select()}),100);break;case"textarea":u(),jQuery("#fb-new-field"+l+" .fb-fields").html(p+s+j)}e.fields[l].type=i}catch(e){}}return{resizePop:function(){try{var e=jQuery("body",window.parent.document).width(),i=jQuery("body",window.parent.document).height(),n=void 0===document.body.style.maxHeight;jQuery("#TB_window, #TB_iframeContent",window.parent.document).css("width","768px"),jQuery("#TB_window",window.parent.document).css({left:(e-768)/2+"px",top:"23px",position:"absolute",marginLeft:"0"}),n||jQuery("#TB_window, #TB_iframeContent",window.parent.document).css("height",i-73+"px")}catch(e){}},init:function(){var a;window.parent.scroll(0,0),a=jQuery("#edButtonPreview",window.parent.document).hasClass("active")||jQuery("#wp-content-wrap",window.parent.document).hasClass("tmce-active")?(window.dialogArguments||opener||parent||top).tinyMCE.activeEditor.getContent():jQuery("#content",window.parent.document).val();var u={action:"grunion_shortcode_to_json",_ajax_nonce:ajax_nonce_json,post_id:postId,content:a},y=jQuery(document);jQuery.post(ajaxurl,u,(function(n){!function(n){try{e.fields={},n?(jQuery.each(n.fields,(function(i,n){1===parseInt(n.required,10)&&(n.required="true"),e.fields[i]=n})),e.to=n.to,e.subject=n.subject):e.fields=i}catch(e){}}(jQuery.parseJSON(n)),function(){try{e.to&&jQuery("#fb-field-my-email").val(e.to),e.subject&&jQuery("#fb-field-subject").val(e.subject),jQuery.each(e.fields,(function(e,i){jQuery("#fb-extra-fields").before('<div class="fb-new-fields ui-state-default" fieldid="'+e+'" id="fb-new-field'+e+'"><div class="fb-fields"></div></div>'),jQuery("#fb-field-id").val(e),o[e]={},o[e].options=[],"radio"!==i.type&&"select"!==i.type&&"checkbox-multiple"!==i.type||jQuery.each(i.options,(function(i,n){o[e].options[i]=n})),v(i.type,i.label,i.required)}))}catch(e){}}()})),jQuery(".fb-add-field").click((function(){return function(){try{++n<=t?(jQuery("#fb-extra-fields").append('<div id="fb-new-field'+n+'" fieldid="'+n+'" class="fb-new-fields"><div class="fb-fields"><div id="'+n+'" class="fb-remove"></div><label fieldid="'+n+'" for="fb-field'+n+'"><span class="label-text">'+GrunionFB_i18n.newLabel+'</span> </label><input type="text" id="fb-field'+n+'" disabled="disabled" /></div></div>'),e.fields[n]={label:GrunionFB_i18n.newLabel,type:"text",required:!1,options:[],order:"5"},n===t&&jQuery("#fb-new-field").hide(),r=0,o={},jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />'),jQuery("#fb-options").hide(),jQuery("#fb-new-label").val(GrunionFB_i18n.newLabel),jQuery("#fb-new-type").val("text"),jQuery("#fb-field-id").val(n),setTimeout((function(){jQuery("#fb-new-label").focus().select()}),100)):jQuery("#fb-new-field").hide()}catch(e){}}(),d(),!1})),jQuery("#fb-new-label").keyup((function(){!function(){try{var i=jQuery("#fb-field-id").val(),n=jQuery("#fb-new-label").val();0===n.length?jQuery("#fb-new-field"+i+" label .label-text").text(GrunionFB_i18n.newLabel):jQuery("#fb-new-field"+i+" label .label-text").text(n),e.fields[i].label=n}catch(e){}}()})),jQuery("#fb-new-type").change((function(){v()})),jQuery("#fb-new-required").click((function(){!function(){try{var i=jQuery("#fb-field-id").val();jQuery("#fb-new-required").is(":checked")?(e.fields[i].required=!0,jQuery("#fb-new-field"+i+" label").append('<span class="label-required">'+GrunionFB_i18n.requiredLabel+"</span>")):(e.fields[i].required=!1,jQuery("#fb-new-field"+i+" label .label-required").remove())}catch(e){}}()})),y.on("click",".fb-remove",(function(){c(),function(i){try{n--;var o=i.attr("id");delete e.fields[o],jQuery("#"+o).parent().parent().remove(),n<=t&&jQuery("#fb-new-field").show()}catch(e){}}(jQuery(this)),function(){try{jQuery.post(ajaxurl,e,(function(e){}))}catch(e){alert(GrunionFB_i18n.problemGeneratingForm)}}()})),jQuery("#fb-preview").submit((function(){return function(){try{jQuery("div#sortable div.fb-new-fields").each((function(i){var n=jQuery(this).attr("fieldid");e.fields[n].order=i})),jQuery.post(ajaxurl,e,(function(e){var i=jQuery("#edButtonPreview",window.parent.document).hasClass("active");i||(i=jQuery("#wp-content-wrap",window.parent.document).hasClass("tmce-active"));var n,t=window.dialogArguments||opener||parent||top;i?n=t.tinyMCE.activeEditor.getContent():"string"!=typeof(n=jQuery("#editorcontainer textarea",window.parent.document).val())&&(n=jQuery(".wp-editor-area",window.parent.document).val());var o=new RegExp("\\[contact-form\\b.*?\\/?\\](?:[\\s\\S]+?\\[\\/contact-form\\])?");if(e=(e=e.replace(/\n/g," ")).replace(/%26#x002c;/g,","),n.match(o))i?t.tinyMCE.activeEditor.execCommand("mceSetContent",!1,n.replace(o,e)):jQuery("#content",window.parent.document).val(n.replace(o,e));else try{t.send_to_editor(e)}catch(o){i?t.tinyMCE.activeEditor.execCommand("mceInsertContent",!1,e):jQuery("#content",window.parent.document).val(n+e)}s()}))}catch(e){}}(),!1})),jQuery("#TB_overlay, #TB_closeWindowButton",window.parent.document).mousedown((function(){confirm(GrunionFB_i18n.exitConfirmMessage)&&s()})),y.on("click","#fb-another-option",(function(){!function(){try{r=jQuery("#fb-new-options .fb-options").length;var i=jQuery("#fb-field-id").val(),n=jQuery("#fb-new-type").val();"radio"===n?(jQuery("#fb-new-options").append('<div id="fb-option-box-'+r+'" class="fb-new-fields"><span optionid="'+r+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+r+'" optionid="'+r+'" value="'+GrunionFB_i18n.optionLabel+'" class="fb-options" /><div>'),jQuery("#fb-new-field"+i+" .fb-fields").append('<div id="fb-radio-'+i+"-"+r+'"><input type="radio" disabled="disabled" id="fb-field'+i+'" name="radio-'+i+'" /><span>'+GrunionFB_i18n.optionLabel+'</span><div class="clear"></div></div>')):"checkbox-multiple"===n?(jQuery("#fb-new-options").append('<div id="fb-option-box-'+r+'" class="fb-new-fields"><span optionid="'+r+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+r+'" optionid="'+r+'" value="'+GrunionFB_i18n.optionLabel+'" class="fb-options" /><div>'),jQuery("#fb-new-field"+i+" .fb-fields").append('<div id="fb-checkbox-multiple-'+i+"-"+r+'"><input type="checkbox" disabled="disabled" id="fb-field'+i+'" name="checkbox-multiple-'+i+'" /><span>'+GrunionFB_i18n.optionLabel+'</span><div class="clear"></div></div>')):(jQuery("#fb-new-options").append('<div id="fb-option-box-'+r+'" class="fb-new-fields"><span optionid="'+r+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+r+'" optionid="'+r+'" value="" class="fb-options" /><div>'),jQuery("#fb-field"+i).append('<option id="fb-'+i+"-"+r+'" value="'+i+"-"+r+'"></option>')),e.fields[i].options[r]="",jQuery("#fb-option"+r).focus().select()}catch(e){}}()})),y.on("keyup",".fb-options",(function(){!function(i){try{var n=jQuery("#fb-field-id").val(),t=i.attr("optionid"),o=i.val(),r=jQuery("#fb-new-type").val();"radio"===r?jQuery("#fb-radio-"+n+"-"+t+" span").text(o):"checkbox-multiple"===r?jQuery("#fb-checkbox-multiple-"+n+"-"+t+" span").text(o):jQuery("#fb-"+n+"-"+t).text(o),e.fields[n].options[t]=o}catch(e){}}(jQuery(this))})),y.on("click",".fb-remove-option",(function(){!function(i){try{var n=jQuery("#fb-field-id").val(),t=jQuery("#fb-option"+i).val(),o=jQuery("#fb-new-type").val();jQuery("#fb-option-box-"+i).remove(),"radio"===o?jQuery("#fb-radio-"+n+"-"+i).remove():"checkbox-multiple"===o?jQuery("#fb-checkbox-multiple-"+n+"-"+i).remove():jQuery("#fb-"+n+"-"+i).remove();var r=e.fields[n].options.indexOf(t);-1!==r&&e.fields[n].options.splice(r,1)}catch(e){}}(jQuery(this).attr("optionid"))})),jQuery("#tab-preview a").click((function(){return p("preview"),!1})),jQuery("#fb-prev-form").click((function(){return p("preview"),!1})),jQuery("#tab-settings a").click((function(){return p(),!1})),jQuery("#fb-field-my-email").blur((function(){!function(){try{var i=jQuery("#fb-field-my-email").val();e.to=i}catch(e){}}()})),jQuery("#fb-field-subject").blur((function(){!function(){try{var i=jQuery("#fb-field-subject").val();e.subject=i}catch(e){}}()})),y.on("mouseenter",".fb-form-case .fb-new-fields",(function(){f("show",jQuery(this))})),y.on("mouseleave",".fb-form-case .fb-new-fields",(function(){return f("hide"),!1})),y.on("click",".fb-edit-field",(function(){return l(jQuery(this)),!1})),y.on("click",".fb-edit-field .fb-reorder",(function(){return!1})),y.on("click","#fb-save-field",(function(){return c(),b(),!1})),jQuery("#fb-feedback").click((function(){var e=jQuery(this).attr("href");return window.parent.location=e,!1})),jQuery("#sortable").sortable({axis:"y",handle:".fb-reorder",revert:!0,start:function(){jQuery(".fb-edit-field").hide()}}),jQuery("#draggable").draggable({axis:"y",handle:".fb-reorder",connectToSortable:"#sortable",helper:"clone",revert:"invalid"})}}}();