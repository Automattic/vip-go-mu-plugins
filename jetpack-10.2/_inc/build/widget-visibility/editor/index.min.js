!function(){"use strict";var e=window.wp.element,t=window.wp.components,a=window.wp.i18n,l=window.wp.blockEditor,i=window.wp.compose;const __=a.__,_x=a._x,c={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&nbsp;":" "},o=/&(?:amp|lt|gt|quot|#39|nbsp);/g,n=e=>{if("string"!=typeof e)return e;return e.replace(o,(e=>c[e]))},s=e=>!new Set(["core/legacy-widget","core/widget-area"]).has(e);wp.hooks.addFilter("blocks.registerBlockType","widget/visibility",(function(e,t){return s(t)&&void 0!==e.attributes&&(e.attributes=Object.assign(e.attributes,{conditions:{type:"object",default:{}}})),e}));const r=(e,t=0)=>e.reduce(((e,a)=>{const[l,i]=a,c=" ".repeat(3*t);if(Array.isArray(i)){const a={label:n(c+l),value:l,disabled:!0},o=r(i,t+1);return e.concat([a]).concat(o)}const o={label:n(c+i),value:l};return e.concat([o])}),[]),d=e=>{const{rule:a,onDelete:l,setMajor:i,setMinor:c}=e,o=[{label:__("User","jetpack"),value:"loggedin"},{label:__("Role","jetpack"),value:"role"}],n="undefined"!=typeof wpcom,s=widget_conditions_data.taxonomy&&widget_conditions_data.taxonomy.length>1||"taxonomy"===a.major,d=[{label:__("Taxonomy","jetpack"),value:"taxonomy"}],u=[{label:__("-- Select --","jetpack"),value:""},{label:__("Category","jetpack"),value:"category"},{label:__("Author","jetpack"),value:"author"}].concat(n?[]:o).concat([{label:__("Tag","jetpack"),value:"tag"},{label:__("Date","jetpack"),value:"date"},{label:__("Page","jetpack"),value:"page"}]).concat(s?d:[]);let m=[];return a.major in widget_conditions_data&&(m=r(widget_conditions_data[a.major])),React.createElement("div",{className:"widget-vis__rule"},React.createElement("div",{className:"widget-vis__rule-major"},React.createElement("span",{className:"widget-vis__if"},_x("If","Widget Visibility: If {Rule Major [Page]} is {Rule Minor [Search results]}","jetpack")),React.createElement("div",{className:"widget-vis__select"},React.createElement(t.SelectControl,{label:__("Major Rule","jetpack"),hideLabelFromVision:!0,value:a.major,options:u,onChange:i}))),a.major&&React.createElement("div",{className:"widget-vis__rule-minor"},React.createElement("span",{className:"widget-vis__is"},_x("is","Widget Visibility: {Rule Major [Page]} is {Rule Minor [Search results]}","jetpack")),React.createElement("div",{className:"widget-vis__select"},React.createElement(t.SelectControl,{className:"widget-vis__select-multi-level",label:__("Minor Rule","jetpack"),hideLabelFromVision:!0,value:a.minor,options:m,onChange:c}))),React.createElement("div",{className:"widget-vis__delete-rule"},React.createElement(t.Button,{onClick:l,isSmall:!0,isSecondary:!0},_x("Remove","Delete this visibility rule","jetpack"))))},u=e=>({action:"show",rules:[],match_all:0,...e}),m=(0,i.createHigherOrderComponent)((a=>i=>{const{attributes:c,setAttributes:o,isSelected:n}=i,r=(0,e.useMemo)((()=>c.conditions||{}),[c]),m=(0,e.useMemo)((()=>r.rules||[]),[r]),g=(0,e.useCallback)((()=>o({conditions:{...u(r),match_all:"0"===r.match_all?"1":"0"}})),[o,r]),p=(0,e.useCallback)((e=>o({conditions:{...u(r),action:e}})),[o,r]),w=(0,e.useCallback)((()=>{const e=[...m,{major:"",minor:""}];o({conditions:{...u(r),rules:e}})}),[o,r,m]),_=(0,e.useCallback)((e=>{const t=[...m.slice(0,e),...m.slice(e+1)];o({conditions:{...u(r),rules:t}})}),[o,r,m]),b=(0,e.useCallback)(((e,t)=>{let a="";t in widget_conditions_data&&Array.isArray(widget_conditions_data[t])&&widget_conditions_data[t].length>0&&(a=widget_conditions_data[t][0][0]);const l=[...m.slice(0,e),{...m[e],major:t,minor:a},...m.slice(e+1)];o({conditions:{...u(r),rules:l}})}),[o,r,m]),v=(0,e.useCallback)(((e,t)=>{if(t&&t.includes("__HEADER__"))return;const a=[...m.slice(0,e),{...m[e],minor:t},...m.slice(e+1)];o({conditions:{...u(r),rules:a}})}),[o,r,m]);let k=null;return k=0===m.length?React.createElement(t.BaseControl,{id:"widget-vis__wrapper",className:"widget-vis__wrapper",label:__("Visibility","jetpack"),help:__("No visibility rules yet. Add at least one rule to use this feature.","jetpack")},React.createElement(t.Button,{isSecondary:!0,onClick:w,className:"widget-vis__add-new-rule"},__("Add new rule","jetpack"))):React.createElement(t.BaseControl,{className:"widget-vis__wrapper",id:"widget-vis__wrapper",label:__("Visibility","jetpack")},React.createElement(t.SelectControl,{className:"widget-vis__show-hide",label:__("Action","jetpack"),hideLabelFromVision:!0,value:c.action,options:[{label:__("Show this block","jetpack"),value:"show"},{label:__("Hide this block","jetpack"),value:"hide"}],onChange:p}),m.map(((e,t)=>React.createElement(d,{key:t,rule:e,i:t,onDelete:()=>_(t),setMajor:e=>b(t,e),setMinor:e=>v(t,e)}))),m.length>1&&React.createElement(t.ToggleControl,{className:"widget-vis__match-all",label:__("Match all rules","jetpack"),checked:"1"===r.match_all,onChange:g}),React.createElement(t.Button,{isSecondary:!0,onClick:w},__("Add new rule","jetpack"))),React.createElement(e.Fragment,null,React.createElement(a,i),n&&s(i.name)&&React.createElement(l.InspectorAdvancedControls,null,k))}),"visibilityAdvancedControls");wp.hooks.addFilter("editor.BlockEdit","widget/visibility",m),window.WidgetVisibility={}.WidgetVisibility}();