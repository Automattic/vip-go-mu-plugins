!function(){"use strict";var e={399:function(e){e.exports=window.wp.blockEditor},997:function(e){e.exports=window.wp.components},417:function(e){e.exports=window.wp.compose},707:function(e){e.exports=window.wp.data},27:function(e){e.exports=window.wp.element},163:function(e){e.exports=window.wp.i18n}},t={};function a(i){var l=t[i];if(void 0!==l)return l.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,a),o.exports}a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};!function(){var e=a(27),t=a(997),i=a(163),l=a(399),o=a(417),n=a(707);const __=i.__,_x=i._x,c={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&nbsp;":" "},s=/&(?:amp|lt|gt|quot|#39|nbsp);/g,r=e=>{if("string"!=typeof e)return e;return e.replace(s,(e=>c[e]))},d=e=>!new Set(["core/legacy-widget","core/widget-area"]).has(e);wp.hooks.addFilter("blocks.registerBlockType","widget/visibility",(function(e,t){return d(t)&&void 0!==e.attributes&&(e.attributes=Object.assign(e.attributes,{conditions:{type:"object",default:{}}})),e}));const u=(e,t=0)=>e.reduce(((e,a)=>{const[i,l]=a,o=" ".repeat(3*t);if(Array.isArray(l)){const a={label:r(o+i),value:i,disabled:!0},n=u(l,t+1);return e.concat([a]).concat(n)}const n={label:r(o+l),value:i};return e.concat([n])}),[]),p=e=>{const{rule:a,onDelete:i,setMajor:l,setMinor:o}=e,n=[{label:__("User","jetpack"),value:"loggedin"},{label:__("Role","jetpack"),value:"role"}],c="undefined"!=typeof wpcom,s=widget_conditions_data.taxonomy&&widget_conditions_data.taxonomy.length>1||"taxonomy"===a.major,r=[{label:__("Taxonomy","jetpack"),value:"taxonomy"}],d=[{label:__("-- Select --","jetpack"),value:""},{label:__("Category","jetpack"),value:"category"},{label:__("Author","jetpack"),value:"author"}].concat(c?[]:n).concat([{label:__("Tag","jetpack"),value:"tag"},{label:__("Date","jetpack"),value:"date"},{label:__("Page","jetpack"),value:"page"}]).concat(s?r:[]);let p=[];return a.major in widget_conditions_data&&(p=u(widget_conditions_data[a.major])),React.createElement("div",{className:"widget-vis__rule"},React.createElement("div",{className:"widget-vis__rule-major"},React.createElement("span",{className:"widget-vis__if"},_x("If","Widget Visibility: If {Rule Major [Page]} is {Rule Minor [Search results]}","jetpack")),React.createElement("div",{className:"widget-vis__select"},React.createElement(t.SelectControl,{label:__("Major Rule","jetpack"),hideLabelFromVision:!0,value:a.major,options:d,onChange:l}))),a.major&&React.createElement("div",{className:"widget-vis__rule-minor"},React.createElement("span",{className:"widget-vis__is"},_x("is","Widget Visibility: {Rule Major [Page]} is {Rule Minor [Search results]}","jetpack")),React.createElement("div",{className:"widget-vis__select"},React.createElement(t.SelectControl,{className:"widget-vis__select-multi-level",label:__("Minor Rule","jetpack"),hideLabelFromVision:!0,value:a.minor,options:p,onChange:o}))),React.createElement("div",{className:"widget-vis__delete-rule"},React.createElement(t.Button,{onClick:i,isSmall:!0,isSecondary:!0},_x("Remove","Delete this visibility rule","jetpack"))))},m=e=>({action:"show",rules:[],match_all:0,...e}),w=(0,o.createHigherOrderComponent)((a=>i=>{const{clientId:o,attributes:c,setAttributes:s,isSelected:r}=i,u=(0,e.useMemo)((()=>c.conditions||{}),[c]),w=(0,e.useMemo)((()=>u.rules||[]),[u]),g=(0,n.useSelect)((e=>{const{getBlockParents:t,getBlock:a}=e("core/block-editor"),i=t(o,!0),l=i?a(i[0]):void 0;return!l||l&&"core/widget-area"===l.name}),[o]),_=(0,e.useCallback)((()=>s({conditions:{...m(u),match_all:"0"===u.match_all?"1":"0"}})),[s,u]),b=(0,e.useCallback)((e=>s({conditions:{...m(u),action:e}})),[s,u]),v=(0,e.useCallback)((()=>{const e=[...w,{major:"",minor:""}];s({conditions:{...m(u),rules:e}})}),[s,u,w]),k=(0,e.useCallback)((e=>{const t=[...w.slice(0,e),...w.slice(e+1)];s({conditions:{...m(u),rules:t}})}),[s,u,w]),j=(0,e.useCallback)(((e,t)=>{let a="";t in widget_conditions_data&&Array.isArray(widget_conditions_data[t])&&widget_conditions_data[t].length>0&&(a=widget_conditions_data[t][0][0]);const i=[...w.slice(0,e),{...w[e],major:t,minor:a},...w.slice(e+1)];s({conditions:{...m(u),rules:i}})}),[s,u,w]),h=(0,e.useCallback)(((e,t)=>{if(t&&t.includes("__HEADER__"))return;const a=[...w.slice(0,e),{...w[e],minor:t},...w.slice(e+1)];s({conditions:{...m(u),rules:a}})}),[s,u,w]);let y=null;return y=0===w.length?React.createElement(t.BaseControl,{id:"widget-vis__wrapper",className:"widget-vis__wrapper",label:__("Visibility","jetpack"),help:__("No visibility rules yet. Add at least one rule to use this feature.","jetpack")},React.createElement(t.Button,{isSecondary:!0,onClick:v,className:"widget-vis__add-new-rule"},__("Add new rule","jetpack"))):React.createElement(t.BaseControl,{className:"widget-vis__wrapper",id:"widget-vis__wrapper",label:__("Visibility","jetpack")},React.createElement(t.SelectControl,{className:"widget-vis__show-hide",label:__("Action","jetpack"),hideLabelFromVision:!0,value:c.action,options:[{label:__("Show this block","jetpack"),value:"show"},{label:__("Hide this block","jetpack"),value:"hide"}],onChange:b}),w.map(((e,t)=>React.createElement(p,{key:t,rule:e,i:t,onDelete:()=>k(t),setMajor:e=>j(t,e),setMinor:e=>h(t,e)}))),w.length>1&&React.createElement(t.ToggleControl,{className:"widget-vis__match-all",label:__("Match all rules","jetpack"),checked:"1"===u.match_all,onChange:_}),React.createElement(t.Button,{isSecondary:!0,onClick:v},__("Add new rule","jetpack"))),React.createElement(e.Fragment,null,React.createElement(a,i),r&&g&&d(i.name)&&React.createElement(l.InspectorAdvancedControls,null,y),r&&!g&&d(i.name)&&React.createElement(l.InspectorAdvancedControls,null,React.createElement(t.BaseControl,{id:"widget-vis__wrapper",className:"widget-vis__wrapper",label:__("Visibility","jetpack"),help:__("Please select the top level block of this widget to apply visibility rules.","jetpack")})))}),"visibilityAdvancedControls");wp.hooks.addFilter("editor.BlockEdit","widget/visibility",w)}(),window.WidgetVisibility={}.WidgetVisibility}();