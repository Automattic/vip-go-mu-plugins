!function(){var e={8900:function(e){function t(){return e.exports=t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},e.exports.default=e.exports,e.exports.__esModule=!0,t.apply(this,arguments)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},9105:function(e,t){var n;
/*!
  Copyright (c) 2018 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/!function(){"use strict";var r={}.hasOwnProperty;function l(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var s=typeof n;if("string"===s||"number"===s)e.push(n);else if(Array.isArray(n)){if(n.length){var a=l.apply(null,n);a&&e.push(a)}}else if("object"===s)if(n.toString===Object.prototype.toString)for(var i in n)r.call(n,i)&&n[i]&&e.push(i);else e.push(n.toString())}}return e.join(" ")}e.exports?(l.default=l,e.exports=l):void 0===(n=function(){return l}.apply(t,[]))||(e.exports=n)}()},2601:function(e){"use strict";function t(e,n){var r;if(Array.isArray(n))for(r=0;r<n.length;r++)t(e,n[r]);else for(r in n)e[r]=(e[r]||[]).concat(n[r])}e.exports=function(e){var n,r={};return t(r,e),(n=function(e){return function(t){return function(n){var l,s,a=r[n.type],i=t(n);if(a)for(l=0;l<a.length;l++)(s=a[l](n,e))&&e.dispatch(s);return i}}}).effects=r,n}},5630:function(e,t,n){"object"==typeof window&&window.Jetpack_Block_Assets_Base_Url&&window.Jetpack_Block_Assets_Base_Url.url&&(n.p=window.Jetpack_Block_Assets_Base_Url.url)},1635:function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.size,n=void 0===t?24:t,l=e.onClick,s=(e.icon,e.className),i=function(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["size","onClick","icon","className"]),o=["gridicon","gridicons-fullscreen",s,!1,!1,!1].filter(Boolean).join(" ");return a.default.createElement("svg",r({className:o,height:n,width:n,onClick:l},i,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"}),a.default.createElement("g",null,a.default.createElement("path",{d:"M21 3v6h-2V6.41l-3.29 3.3-1.42-1.42L17.59 5H15V3zM3 3v6h2V6.41l3.29 3.3 1.42-1.42L6.41 5H9V3zm18 18v-6h-2v2.59l-3.29-3.29-1.41 1.41L17.59 19H15v2zM9 21v-2H6.41l3.29-3.29-1.41-1.42L5 17.59V15H3v6z"})))};var l,s=n(6141),a=(l=s)&&l.__esModule?l:{default:l};e.exports=t.default},6141:function(e){"use strict";e.exports=window.React}},t={};function n(r){var l=t[r];if(void 0!==l)return l.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e+"../"}();var r={};!function(){"use strict";n(5630)}(),function(){"use strict";n.r(r);var e={};n.r(e),n.d(e,{init:function(){return S},resetCurrentSlideProgress:function(){return g},setBuffering:function(){return v},setCurrentSlideEnded:function(){return E},setCurrentSlideProgress:function(){return y},setEnded:function(){return w},setFullscreen:function(){return h},setMuted:function(){return d},setPlaying:function(){return p},showSlide:function(){return m},slideReady:function(){return f}});var t={};n.r(t),n.d(t,{getCurrentMediaDuration:function(){return I},getCurrentMediaElement:function(){return R},getCurrentSlideIndex:function(){return k},getCurrentSlideProgress:function(){return N},getCurrentSlideProgressPercentage:function(){return C},getPreviousSlideMediaElement:function(){return L},getSettings:function(){return F},getSlideCount:function(){return D},hasCurrentSlideEnded:function(){return T},hasEnded:function(){return z},isBuffering:function(){return _},isCurrentSlideReady:function(){return M},isFullscreen:function(){return O},isMuted:function(){return P},isPlayerReady:function(){return b},isPlaying:function(){return x}});var l=n(8900),s=n.n(l),a=window.wp.element,i=window.wp.domReady,o=n.n(i),c=window.wp.data,u=window.wp.keycodes;function d(e,t){return{type:"SET_MUTED",value:t,playerId:e}}function p(e,t){return{type:"SET_PLAYING",value:t,playerId:e}}function m(e,t){return{type:"SHOW_SLIDE",index:t,playerId:e}}function f(e,t,n){return{type:"SLIDE_READY",mediaElement:t,duration:n,playerId:e}}function y(e,t){return{type:"SET_CURRENT_SLIDE_PROGRESS",value:t,playerId:e}}function g(e){return{type:"RESET_CURRENT_SLIDE_PROGRESS",playerId:e}}function E(e){return{type:"SET_CURRENT_SLIDE_ENDED",playerId:e}}function h(e,t){return{type:"SET_FULLSCREEN",playerId:e,fullscreen:t}}function w(e){return{type:"ENDED",playerId:e}}function S(e,t={}){return{type:"INIT",playerId:e,settings:t}}function v(e,t){return{type:"SET_BUFFERING",value:t,playerId:e}}function b(e,t){return!!e[t]}function k(e,t){return e[t].currentSlide.index}function N(e,t){return e[t].currentSlide.progress}function C(e,t){const n=e[t].currentSlide.progress.currentTime,r=e[t].currentSlide.progress.duration,l=Math.round(100*n/r);return l>=100?100:l}function x(e,t){return e[t].playing}function P(e,t){return e[t].muted}function _(e,t){return e[t].buffering}function R(e,t){return e[t].currentSlide.mediaElement}function I(e,t){return e[t].currentSlide.duration}function T(e,t){return e[t].currentSlide.ended}function M(e,t){return e[t].currentSlide.ready}function L(e,t){var n;return null===(n=e[t].previousSlide)||void 0===n?void 0:n.mediaElement}function O(e,t){return e[t].fullscreen}function z(e,t){return e[t].ended}function F(e,t){return e[t].settings}function D(e,t){return e[t].settings.slideCount}var A=n(2601),j=n.n(A),U=window.lodash;const B=e=>e&&e.src&&"video"===e.tagName.toLowerCase();function H(e,t){const{getState:n}=t,r=e.playerId,l=P(n(),r),s=x(n(),r),a=R(n(),r),i=L(n(),r),o=F(n(),r);B(i)&&(i.currentTime=0,i.onwaiting=null,i.onplaying=null,i.pause()),B(a)&&(l!==a.muted&&(a.muted=l,l||(a.volume=o.volume)),s?a.play():a.pause())}function q(e,t){const{getState:n,dispatch:r}=t,l=e.playerId,s=M(n(),l),a=x(n(),l),i=N(n(),l);if(clearTimeout(i.timeout),!a||!s)return void(i.lastUpdate&&r(y(l,{...i,lastUpdate:null})));const o=R(n(),l),c=I(n(),l),u=i.lastUpdate?Date.now()-i.lastUpdate:100,d=B(o)?o.currentTime:i.currentTime+u/1e3;if(d>=c){r(E(l));const e=D(n(),l);k(n(),l)===e-1&&r(w(l))}else r(y(l,{timeout:setTimeout((()=>q(e,t)),100),lastUpdate:Date.now(),duration:c,currentTime:d}))}var G={SET_PLAYING:[q,H],SLIDE_READY:[function(e,t){const{getState:n,dispatch:r}=t,l=e.playerId,s=R(n(),l);if(!B(s))return;const a=N(n(),l);0===s.currentTime&&a.currentTime>0&&(s.currentTime=a.currentTime),s.onwaiting=()=>r(v(l,!0)),s.onplaying=()=>r(v(l,!1))},q,H],SET_MUTED:H,SHOW_SLIDE:H};const $={currentTime:0,duration:null,timeout:null,lastUpdate:null},V={progress:$,index:0,mediaElement:null,duration:null,ended:!1,ready:!1},W={slideCount:0,currentSlide:V,previousSlide:null,muted:!1,playing:!1,ended:!1,buffering:!1,fullscreen:!1,settings:{imageTime:5,startMuted:!1,playInFullscreen:!0,playOnNextSlide:!0,playOnLoad:!1,exitFullscreenOnEnd:!0,loadInFullscreen:!1,blurredBackground:!0,showSlideCount:!1,showProgressBar:!0,shadowDOM:{enabled:!0,mode:"open",globalStyleElements:'#jetpack-block-story-css, link[href*="jetpack/_inc/blocks/story/view.css"]'},defaultAspectRatio:.5625,cropUpTo:.2,volume:.8,maxBullets:7,maxBulletsFullscreen:14}};function K(e=W,t){switch(t.type){case"SHOW_SLIDE":{const n=e.currentSlide===t.index+1;return{...e,currentSlide:{...V,index:t.index},previousSlide:e.currentSlide,playing:n?e.settings.playOnNextSlide:e.playing}}case"SLIDE_READY":return{...e,buffering:!1,currentSlide:{...e.currentSlide,mediaElement:t.mediaElement,duration:t.duration,ready:!0},previousSlide:null};case"SET_CURRENT_SLIDE_PROGRESS":return{...e,currentSlide:{...e.currentSlide,progress:t.value}};case"SET_CURRENT_SLIDE_ENDED":return{...e,currentSlide:{...e.currentSlide,ended:!0}};case"RESET_CURRENT_SLIDE_PROGRESS":return{...e,currentSlide:{...e.currentSlide,progress:{...$}}};case"SET_MUTED":return{...e,muted:t.value};case"SET_PLAYING":{const n=t.value&&e.ended;return{...e,playing:t.value,buffering:!!t.value&&e.buffering,fullscreen:!e.playing&&t.value?e.settings.playInFullscreen:e.fullscreen,ended:!n&&e.ended,currentSlide:n?{...V,index:0}:e.currentSlide,previousSlide:n?null:e.previousSlide}}case"SET_BUFFERING":return{...e,buffering:t.value};case"SET_FULLSCREEN":return{...e,fullscreen:t.fullscreen,playing:!(e.fullscreen&&!t.fullscreen&&e.settings.playInFullscreen)&&e.playing};case"INIT":{const n=(0,U.merge)({},e.settings,t.settings);return{...e,settings:n,playing:n.playOnLoad,fullscreen:n.loadInFullscreen}}case"ENDED":return{...e,currentSlide:{...V,index:e.settings.slideCount-1,progress:{...$,currentTime:100,duration:100}},ended:!0,playing:!1,fullscreen:!e.settings.exitFullscreenOnEnd}}return e}const Y=(0,c.registerStore)("jetpack/story/player",{actions:e,reducer:function(e={},t){return t.playerId?{...e,[t.playerId]:K(e[t.playerId],t)}:e},selectors:t});!function(e){const t=[j()(G)];let n=()=>{throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},r=[];const l={getState:e.getState,dispatch:(...e)=>n(...e)};r=t.map((e=>e(l))),n=(0,U.flowRight)(...r)(e.dispatch),e.dispatch=n}(Y);var J=n(9105),Q=n.n(J),X=window.wp.blob,Z=window.wp.compose,ee=window.wp.i18n;var te=window.wp.components;const __=ee.__;function ne({isEllipsis:e,disabled:t,index:n,isSelected:r,progress:l,onClick:s}){const i=t||e;let o=null;return e||(o=r?(0,ee.sprintf)(__("Slide %d, currently selected","jetpack"),n+1):(0,ee.sprintf)(__("Go to slide %d","jetpack"),n+1)),(0,a.createElement)(te.Button,{role:i?"presentation":"tab",key:n,className:Q()("wp-story-pagination-bullet",{"wp-story-pagination-ellipsis":e}),"aria-label":o,"aria-disabled":i||r,onClick:i||r?void 0:s,disabled:i},(0,a.createElement)("div",{className:"wp-story-pagination-bullet-bar"},(0,a.createElement)("div",{className:"wp-story-pagination-bullet-bar-progress",style:{width:`${l}%`}})))}const re=({className:e,size:t,label:n,isPressed:r,...l})=>(0,a.createElement)("button",s()({type:"button","aria-label":n,"aria-pressed":r,className:Q()("jetpack-mdc-icon-button","circle-icon","outlined","bordered",e),style:{width:`${t}px`,height:`${t}px`}},l)),le=({className:e,size:t=24,label:n,isPressed:r,...l})=>(0,a.createElement)("button",s()({type:"button","aria-label":n,"aria-pressed":r,className:Q()("jetpack-mdc-icon-button",e),style:{width:`${t}px`,height:`${t}px`}},l));var se=(e,t=24,n=24,r="0 0 24 24")=>(0,a.createElement)(te.SVG,{xmlns:"http://www.w3.org/2000/svg",width:t,height:n,viewBox:r},(0,a.createElement)(te.Path,{fill:"none",d:"M0 0h24v24H0V0z"}),e);const ae=({children:e,size:t})=>se(e,t,t),ie=({size:e})=>(0,a.createElement)(ae,{size:e},(0,a.createElement)(te.Path,{d:"M8 5v14l11-7z"})),oe=({size:e})=>(0,a.createElement)(ae,{size:e},(0,a.createElement)(te.Path,{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})),ce=({size:e})=>(0,a.createElement)(ae,{size:e},(0,a.createElement)(te.Path,{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),ue=({size:e})=>(0,a.createElement)(ae,{size:e},(0,a.createElement)(te.Path,{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})),de=({size:e})=>(0,a.createElement)(ae,{size:e},(0,a.createElement)(te.Path,{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"})),pe=({size:e})=>(0,a.createElement)(ae,{size:e},(0,a.createElement)(te.Path,{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})),me=({size:e})=>(0,a.createElement)(ae,{size:e},(0,a.createElement)(te.Path,{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})),fe=ee.__;function ye({playing:e,muted:t,onPlayPressed:n,onMutePressed:r,showMute:l}){return(0,a.createElement)("div",{className:"wp-story-controls"},(0,a.createElement)(le,{isPressed:e,label:fe(e?"pause":"play","jetpack"),onClick:n},e?(0,a.createElement)(oe,null):(0,a.createElement)(ie,null)),l&&(0,a.createElement)(le,{isPressed:t,label:fe(t?"unmute":"mute","jetpack"),onClick:r},t?(0,a.createElement)(de,null):(0,a.createElement)(ue,null)))}const ge=ee.__;function Ee({fullscreen:e,onExitFullscreen:t,siteIconUrl:n,storyTitle:r}){return e?(0,a.createElement)("div",{className:"wp-story-meta"},(0,a.createElement)("div",{className:"wp-story-icon"},(0,a.createElement)("img",{alt:ge("Site icon","jetpack"),src:n,width:"40",height:"40"})),(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"wp-story-title"},r)),(0,a.createElement)(le,{className:"wp-story-exit-fullscreen",label:ge("Exit Fullscreen","jetpack"),onClick:t},(0,a.createElement)(ce,null))):null}var he=n(1635),we=n.n(he);const Se=ee.__;function ve({ended:e,hasPrevious:t,onNextSlide:n,onPreviousSlide:r,icon:l,slideCount:s,showSlideCount:i}){const o=(0,a.useCallback)((t=>{e||(t.stopPropagation(),r())}),[r,e]),c=(0,a.useCallback)((t=>{e||(t.stopPropagation(),n())}),[n,e]);return(0,a.createElement)("div",{className:"wp-story-overlay"},i&&(0,a.createElement)("div",{className:"wp-story-embed-icon"},l,(0,a.createElement)("span",null,s)),!i&&(0,a.createElement)("div",{className:"wp-story-embed-icon-expand"},(0,a.createElement)(we(),{role:"img"})),t&&(0,a.createElement)("div",{className:"wp-story-prev-slide",onClick:o},(0,a.createElement)(re,{size:44,label:Se("Previous Slide","jetpack"),className:"outlined-w"},(0,ee.isRTL)()?(0,a.createElement)(me,{size:24}):(0,a.createElement)(pe,{size:24}))),(0,a.createElement)("div",{className:"wp-story-next-slide",onClick:c},(0,a.createElement)(re,{size:44,label:Se("Next Slide","jetpack"),className:"outlined-w"},(0,ee.isRTL)()?(0,a.createElement)(pe,{size:24}):(0,a.createElement)(me,{size:24}))))}function be({currentMedia:e}){const t=e&&"image"===e.type?e.url:null;return(0,a.createElement)("div",{className:"wp-story-background"},(0,a.createElement)("div",{className:"wp-story-background-image",style:{backgroundImage:t?`url("${t}")`:"none"}}),(0,a.createElement)("div",{className:"wp-story-background-blur"}),(0,a.createElement)(te.SVG,{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"0",height:"0"},(0,a.createElement)("filter",{id:"gaussian-blur-18"},(0,a.createElement)("feGaussianBlur",{stdDeviation:"18"}))))}var ke=()=>(0,a.createElement)("div",{className:"wp-story-loading-spinner"},(0,a.createElement)("div",{className:"wp-story-loading-spinner__outer"},(0,a.createElement)("div",{className:"wp-story-loading-spinner__inner"})));const Ne=({title:e,alt:t,className:n,id:r,mediaRef:l,mime:s,sizes:i,srcset:o,url:c})=>(0,a.createElement)("img",{ref:l,"data-id":r,"data-mime":s,title:e,alt:t,src:c,className:Q()("wp-story-image",`wp-image-${r}`,n),srcSet:o,sizes:i}),Ce=({title:e,className:t,id:n,mediaRef:r,mime:l,url:s,poster:i})=>(0,a.createElement)("video",{className:Q()("wp-story-video","intrinsic-ignore",`wp-video-${n}`,t),ref:r,"data-id":n,title:e,type:l,src:s,poster:i,tabIndex:-1,preload:"auto",playsInline:!0}),xe=({targetAspectRatio:e,cropUpTo:t,type:n,width:r,height:l,...i})=>{let o=null;if(r&&l){const n=r/l;if(n>=e){n>e/(1-t)||(o="wp-story-crop-wide")}else{n<e*(1-t)||(o="wp-story-crop-narrow")}}const c="video"===n||(i.mime||"").startsWith("video/");return(0,a.createElement)("figure",null,c?(0,a.createElement)(Ce,s()({},i,{className:o})):(0,a.createElement)(Ne,s()({},i,{className:o})))};var Pe=({playerId:e,media:t,index:n,playing:r,uploading:l,settings:i,targetAspectRatio:o})=>{const{currentSlideIndex:u,buffering:d}=(0,c.useSelect)((t=>({currentSlideIndex:t("jetpack/story/player").getCurrentSlideIndex(e),buffering:t("jetpack/story/player").isBuffering(e)})),[]),{slideReady:p}=(0,c.useDispatch)("jetpack/story/player"),m=n===u,f=(0,a.useRef)(null),[y,g]=(0,a.useState)(!1),[E,h]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{if(m&&!E){const t=f.current&&f.current.src&&"video"===f.current.tagName.toLowerCase()?f.current:null;p(e,f.current,t?t.duration:i.imageTime)}}),[m,E]),(0,a.useEffect)((()=>{n<=u+(r?1:0)&&g(!0)}),[r,u]),(0,a.useLayoutEffect)((()=>{f.current&&async function(e){const t=e.tagName.toLowerCase();if("img"===t){if(e.complete)return;await new Promise((t=>{e.addEventListener("load",t,{once:!0})}))}else if("video"===t||"audio"===t){if(e.HAVE_ENOUGH_DATA===e.readyState)return;await new Promise((t=>{e.addEventListener("canplaythrough",t,{once:!0}),e.addEventListener("load",t,{once:!0}),e.HAVE_NOTHING===e.readyState&&e.networkState!==e.NETWORK_LOADING&&e.load()}))}}(f.current).then((()=>{h(!1)}))}),[y,l]),(0,a.createElement)(a.Fragment,null,m&&(E||l||d)&&(0,a.createElement)("div",{className:Q()("wp-story-slide","is-loading",{transparent:r&&d,"semi-transparent":l||!r&&d})},(0,a.createElement)(ke,null)),(0,a.createElement)("div",{role:"figure",className:"wp-story-slide",style:{display:m&&!E?"block":"none"},tabIndex:m?0:-1},y&&(0,a.createElement)(xe,s()({},t,{targetAspectRatio:o,cropUpTo:i.cropUpTo,index:n,mediaRef:f}))))};var _e=se((0,a.createElement)(te.G,null,(0,a.createElement)(te.Path,{d:"M17 5a2 2 0 0 1 2 2v13a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2h9z"}),(0,a.createElement)(te.Path,{d:"M13 4H5a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2z"}),(0,a.createElement)(te.Path,{d:"M7 16h8a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"})));const Re=({key:e,playerId:t,index:n,disabled:r,isSelected:l,onClick:s})=>{const i=(0,c.useSelect)((e=>e("jetpack/story/player").getCurrentSlideProgressPercentage(t)),[]);return(0,a.createElement)(ne,{key:e,index:n,progress:i,disabled:r,isSelected:l,onClick:s})};var Ie=({playerId:e,slides:t,disabled:n,onSlideSeek:r,maxBullets:l})=>{const{currentSlideIndex:s}=(0,c.useSelect)((t=>({currentSlideIndex:t("jetpack/story/player").getCurrentSlideIndex(e)})),[]),i=Math.min(t.length,l),o=Math.floor(i/2);let u,d=0,p=t.length-1;return t.length<=l||s<o?(u=s,p=i-1):s>=t.length-o?(u=s-t.length+i,d=t.length-i):(u=o,d=s-o,p=s+o),(0,a.createElement)("div",{className:"wp-story-pagination wp-story-pagination-bullets",role:"tablist"},d>0&&(0,a.createElement)(ne,{key:"bullet-0",index:d-1,progress:100,isEllipsis:!0}),(0,U.range)(1,i+1).map(((t,l)=>{const i=l+d;let o=null;if(i<s)o=100;else{if(!(i>s))return(0,a.createElement)(Re,{playerId:e,key:`bullet-${l}`,index:i,disabled:n,isSelected:u===l,onClick:()=>r(i)});o=0}return(0,a.createElement)(ne,{key:`bullet-${l}`,index:i,progress:o,disabled:n,isSelected:u===l,onClick:()=>r(i)})})),p<t.length-1&&(0,a.createElement)(ne,{key:`bullet-${i+1}`,index:p+1,progress:0,isEllipsis:!0}))};var Te=e=>{const t=(0,a.useRef)(),n=(0,a.useRef)(),r=(0,a.useRef)(e),l=(0,a.useCallback)((e=>{e.touches&&1===e.touches.length&&e.preventDefault()}),[]);return(0,a.useEffect)((()=>{r.current=e}),[e]),{onTouchStart:(0,a.useCallback)((e=>{e.target&&(e.target.addEventListener("touchend",l,{passive:!1}),n.current=e.target),t.current=setTimeout((()=>{r.current&&r.current(!0),t.current=null}),200)}),[]),onTouchEnd:(0,a.useCallback)((e=>{t.current?clearTimeout(t.current):(r.current&&r.current(!1),e.stopPropagation()),n.current&&n.current.removeEventListener("touchend",l)}),[])}};const Me=ee.__;function Le({id:e,slides:t,metadata:n,disabled:r}){const{setFullscreen:l,setEnded:i,setPlaying:o,setMuted:u,showSlide:d}=(0,c.useDispatch)("jetpack/story/player"),{playing:p,muted:m,currentSlideIndex:f,currentSlideEnded:y,ended:g,fullscreen:E,settings:h}=(0,c.useSelect)((t=>{const{getCurrentSlideIndex:n,getSettings:r,hasCurrentSlideEnded:l,hasEnded:s,isFullscreen:a,isMuted:i,isPlaying:o}=t("jetpack/story/player");return{playing:o(e),muted:i(e),currentSlideIndex:n(e),currentSlideEnded:l(e),ended:s(e),fullscreen:a(e),settings:r(e)}}),[e]),w=(0,a.useRef)(),[S,v]=(0,a.useState)(null),[b,{width:k,height:N}]=(0,Z.useResizeObserver)(),[C,x]=(0,a.useState)(h.defaultAspectRatio),P=(0,U.some)(t,(e=>(0,X.isBlobURL)(e.url))),_=t=>{d(e,t)},R=(0,a.useCallback)((()=>{r||E||h.playInFullscreen&&!p&&o(e,!0)}),[p,r,E]),{onTouchStart:I,onTouchEnd:T}=Te((t=>{o(e,!t)}),[]),M=(0,a.useCallback)((()=>{f>0&&_(f-1)}),[f]),L=(0,a.useCallback)((()=>{f<t.length-1?_(f+1):i(e)}),[f,t]),O=(0,a.useCallback)((()=>{l(e,!1)}),[]);let z,F;return(0,a.useEffect)((()=>{r&&p&&o(e,!1)}),[r,p]),(0,a.useEffect)((()=>{p&&y&&L()}),[p,y]),(0,a.useLayoutEffect)((()=>{if(!w.current)return;let e=Math.round(h.defaultAspectRatio*w.current.offsetHeight);E&&(e=Math.abs(1-e/k)<h.cropUpTo?k:e),v(e)}),[k,N,E]),(0,a.useLayoutEffect)((()=>{S&&w.current&&w.current.offsetHeight>0&&x(S/w.current.offsetHeight)}),[S]),z=E?[Me("You are currently playing a story.","jetpack"),Me(p?"Press space to pause.":"Press space to play.","jetpack"),Me("Press escape to exit.","jetpack")].join(" "):Me("Play story","jetpack"),F=r?"presentation":E?"dialog":"button",(0,a.createElement)("div",{className:"wp-story-display-contents"},b,(0,a.createElement)("div",{role:F,"aria-label":z,tabIndex:E?-1:0,className:Q()("wp-story-container",{"wp-story-with-controls":!r&&!E&&!h.playInFullscreen,"wp-story-fullscreen":E,"wp-story-ended":g,"wp-story-disabled":r,"wp-story-clickable":!r&&!E}),style:{maxWidth:`${S}px`},onClick:R,onTouchStart:I,onTouchEnd:T},(0,a.createElement)(Ee,s()({},n,{fullscreen:E,onExitFullscreen:O})),(0,a.createElement)("div",{ref:w,className:"wp-story-wrapper"},t.map(((t,n)=>(0,a.createElement)(Pe,{playerId:e,key:n,media:t,index:n,playing:!r&&p,uploading:P,settings:h,targetAspectRatio:C})))),(0,a.createElement)(ve,{icon:_e,slideCount:t.length,showSlideCount:h.showSlideCount,ended:g,hasPrevious:f>0,onPreviousSlide:M,onNextSlide:L}),h.showProgressBar&&(0,a.createElement)(Ie,{playerId:e,slides:t,disabled:!E,onSlideSeek:_,maxBullets:E?h.maxBulletsFullscreen:h.maxBullets}),(0,a.createElement)(ye,{playing:p,muted:m,onPlayPressed:()=>o(e,!p),onMutePressed:()=>u(e,!m),showMute:(e=>{const n=e<t.length?t[e]:null;return!!n&&("video"===n.type||(n.mime||"").startsWith("video/"))})(f)})),E&&(0,a.createElement)(be,{currentMedia:h.blurredBackground&&t.length>f&&t[f]}))}const Oe=window&&window.Element&&window.Element.prototype.hasOwnProperty("attachShadow");function ze({enabled:e,delegatesFocus:t=!1,mode:n="open",globalStyleElements:r=[],adoptedStyleSheets:l=null,mountOnElement:s=null,children:i}){const[o,c]=(0,a.useState)(null),u=s||o,[d,p]=(0,a.useState)(null),m="string"==typeof r?[...document.querySelectorAll(r)]:r,f=Oe&&e&&m.length>0,y=(0,a.useCallback)((e=>{null!==e&&c(e.parentNode)}),[]);if((0,a.useEffect)((()=>{if(!u)return;if(u.shadowRoot)return void p(u.shadowRoot);const e=u.attachShadow({delegatesFocus:t,mode:n});l&&(e.adoptedStyleSheets=l),p(e)}),[u]),f&&!d)return s?null:(0,a.createElement)("span",{ref:y});const g=(0,a.createElement)(a.Fragment,null,f&&(0,a.createElement)(Fe,{globalStyleElements:m}),i);return f?(0,a.createPortal)(g,d):g}function Fe({globalStyleElements:e}){return(0,a.createElement)(a.Fragment,null,e.map((({id:e,tagName:t,attributes:n,innerHTML:r},l)=>"LINK"===t?(0,a.createElement)("link",{key:e||l,id:e,rel:n.rel.value,href:n.href.value}):"STYLE"===t?(0,a.createElement)("style",{key:e||l,id:e},r):void 0)))}function De(e){const t=(0,a.useRef)(null),n=(0,a.useRef)(!1),r=(0,a.useRef)(e),l=(0,a.useRef)(e);return l.current=e,(0,a.useLayoutEffect)((()=>{e.forEach(((e,l)=>{const s=r.current[l];"function"==typeof e&&e!==s&&!1===n.current&&(s(null),e(t.current))})),r.current=e}),e),(0,a.useLayoutEffect)((()=>{n.current=!1})),(0,a.useCallback)((e=>{t.current=e,n.current=!0;(e?l.current:r.current).forEach((t=>{"function"==typeof t?t(e):t&&t.hasOwnProperty("current")&&(t.current=e)}))}),[])}function Ae({overlayClassName:e,children:t,className:n,focusOnMount:r,shouldCloseOnEsc:l=!0,onRequestClose:s,onKeyDown:i,modalRef:o}){const c=(0,Z.useFocusOnMount)(r),d=(0,Z.useConstrainedTabbing)(),p=(0,Z.useFocusReturn)();return(0,a.createElement)("div",{className:e,onKeyDown:function(e){l&&e.keyCode===u.ESCAPE&&(e.stopPropagation(),s&&s(e)),e.target&&"button"===e.target.tagName.toLowerCase()&&e.keyCode===u.SPACE||i&&i(e)}},(0,a.createElement)("div",{className:n,ref:De([d,p,c,o])},t))}const je=new Set(["alert","status","log","marquee","timer"]);let Ue=[],Be=!1;function He(e){if(Be)return;const t=document.body.children;(0,U.forEach)(t,(t=>{t!==e&&function(e){const t=e.getAttribute("role");return!("SCRIPT"===e.tagName||e.hasAttribute("aria-hidden")||e.hasAttribute("aria-live")||je.has(t))}(t)&&(t.setAttribute("aria-hidden","true"),Ue.push(t))})),Be=!0}let qe,Ge=0;const $e=()=>{};class Ve extends a.Component{constructor(e){super(e),this.prepareDOM()}componentDidMount(){Ge++,1===Ge&&this.openFirstModal()}componentWillUnmount(){Ge--,0===Ge&&this.closeLastModal(),this.cleanDOM()}prepareDOM(){qe||(qe=document.createElement("div"),document.body.appendChild(qe)),this.node=document.createElement("div"),qe.appendChild(this.node),this.node.ontouchstart=$e,this.node.ontouchend=$e}cleanDOM(){qe.removeChild(this.node)}openFirstModal(){He(qe)}closeLastModal(){Be&&((0,U.forEach)(Ue,(e=>{e.removeAttribute("aria-hidden")})),Ue=[],Be=!1)}render(){const{children:e,isOpened:t,shadowDOM:n,...r}=this.props;return(0,a.createElement)(ze,s()({},n,{mountOnElement:this.node}),t&&(0,a.createElement)(Ae,r,e))}}Ve.defaultProps={shouldCloseOnEsc:!0,isOpened:!1,focusOnMount:!0};var We=(0,Z.withInstanceId)(Ve);const Ke=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent);function Ye({className:e,fullscreenClassName:t,bodyFullscreenClassName:n,fullscreen:r,shadowDOM:l,onKeyDown:s,onExitFullscreen:i,playerQuerySelector:o,children:c}){const u=(0,a.useRef)(),d=(0,a.useRef)(),[p,m]=(0,a.useState)(null),f=Ke&&(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled),y=r&&!f,g=r&&f;return(0,a.useLayoutEffect)((()=>{if(f)r?u.current&&((e,t)=>{if((e.requestFullscreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen).call(e),t){const e=()=>{document.fullscreenElement||(document.removeEventListener("fullscreenchange",e),t())};document.addEventListener("fullscreenchange",e)}})(u.current,i):(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullScreenElement)&&(document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen).call(document);else if(r){if(m([document.documentElement.scrollLeft,document.documentElement.scrollTop]),document.body.classList.add(n),document.getElementsByTagName("html")[0].classList.add(n),d.current){const e=d.current.querySelector(o);e&&e.focus()}}else if(document.body.classList.remove(n),document.getElementsByTagName("html")[0].classList.remove(n),p){window.scrollTo(...p);const e=u.current.querySelector(o);e&&e.focus()}}),[r]),(0,a.createElement)(a.Fragment,null,(0,a.createElement)(ze,l,(0,a.createElement)("div",{ref:u,className:Q()(e,{[t]:g}),onKeyDown:s},!y&&c)),(0,a.createElement)(We,{className:Q()(e,{[t]:y}),isOpened:y,onRequestClose:i,shadowDOM:l,onKeyDown:y&&s,focusOnMount:!1,modalRef:d},y&&c))}function Je({id:e,slides:t,metadata:n,disabled:r,...l}){const s=(0,a.useMemo)((()=>e||Math.random().toString(36)),[e]),{init:i,setEnded:o,setPlaying:d,setFullscreen:p,showSlide:m}=(0,c.useDispatch)("jetpack/story/player"),{playing:f,currentSlideIndex:y,fullscreen:g,isReady:E,playerSettings:h}=(0,c.useSelect)((e=>{const{getCurrentSlideIndex:t,getSettings:n,isFullscreen:r,isPlayerReady:l,isPlaying:a}=e("jetpack/story/player");return l(s)?{playing:a(s),currentSlideIndex:t(s),isReady:!0,fullscreen:r(s),playerSettings:n(s)}:{isReady:!1}}),[s]);(0,a.useEffect)((()=>{E||i(s,{slideCount:t.length,...l})}),[E,s]);const w=(0,a.useCallback)((e=>{switch(e.keyCode){case u.ENTER:if(g)break;case u.SPACE:d(s,!f);break;case u.LEFT:y>0&&m(s,y-1);break;case u.RIGHT:y<t.length-1?m(s,y+1):o(s)}}),[s,y,g,f]),S=(0,a.useCallback)((()=>{p(s,!1)}),[s]);return E?(0,a.createElement)(Ye,{shadowDOM:h.shadowDOM,className:"wp-story-app",fullscreenClassName:"wp-story-fullscreen",bodyFullscreenClassName:"wp-story-in-fullscreen",playerQuerySelector:".wp-story-container",fullscreen:g,onExitFullscreen:S,onKeyDown:w},(0,a.createElement)(Le,{id:s,slides:t,metadata:n,disabled:r})):null}if("undefined"!=typeof window){const e=Array.from(new URLSearchParams(window.location.search).entries()).filter((e=>e[0].startsWith("wp-story-"))).reduce(((e,t)=>{const n=t[0].replace(/^wp-story-/,"").replace(/-([a-z])/g,(e=>e[1].toUpperCase()));try{e[n]=JSON.parse(t[1])}catch(r){e[n]=JSON.parse(`"${t[1]}"`)}return e}),{});o()((function(){const t=[...document.querySelectorAll(":not(#debug-bar-wp-query) .wp-story")];t.forEach((n=>{if("true"===n.getAttribute("data-block-initialized"))return;let r=null;1===t.length&&(r={...e});const l=n.getAttribute("data-settings");if(l)try{r={...r,...JSON.parse(l)}}catch(i){}!function(e,t){"string"==typeof e&&(e=document.querySelectorAll(e));const n=e.querySelector(".wp-story-wrapper"),r=e.querySelector(".wp-story-meta");let l=[];n&&n.children.length>0&&(l=function(e){return[...e.querySelectorAll("li > figure > :first-child")].map((e=>({alt:e.getAttribute("alt")||e.getAttribute("title"),mime:e.getAttribute("data-mime")||e.getAttribute("type"),url:e.getAttribute("src"),id:e.getAttribute("data-id"),type:"img"===e.tagName.toLowerCase()?"image":"video",srcset:e.getAttribute("srcset"),sizes:e.getAttribute("sizes")})))}(n));let i={};r&&r.children.length>0&&(i=function(e){const t=e.querySelector("div:first-child > img"),n=e.querySelector(".wp-story-title"),r=t&&t.src;return{storyTitle:n&&n.innerText,siteIconUrl:r}}(r));const o=function(e){return e.getAttribute("data-id")}(e);(0,a.render)((0,a.createElement)(Je,s()({id:o,slides:l,metadata:i,disabled:!1},t)),e)}(n,r)}))}))}}();var l=window;for(var s in r)l[s]=r[s];r.__esModule&&Object.defineProperty(l,"__esModule",{value:!0})}();